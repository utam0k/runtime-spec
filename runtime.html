<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Runtime and Lifecycle - OCI Runtime Specification</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="spec.html">Open Container Initiative Runtime Specification</a></li><li class="chapter-item expanded "><a href="principles.html"><strong aria-hidden="true">1.</strong> The 5 principles of Standard Containers</a></li><li class="chapter-item expanded "><a href="bundle.html"><strong aria-hidden="true">2.</strong> Filesystem Bundle</a></li><li class="chapter-item expanded "><a href="runtime.html" class="active"><strong aria-hidden="true">3.</strong> Runtime and Lifecycle</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime-linux.html"><strong aria-hidden="true">3.1.</strong> Linux Runtime</a></li></ol></li><li class="chapter-item expanded "><a href="config.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config-linux.html"><strong aria-hidden="true">4.1.</strong> Linux Container Configuration</a></li><li class="chapter-item expanded "><a href="config-solaris.html"><strong aria-hidden="true">4.2.</strong> Solaris Application Container Configuration</a></li><li class="chapter-item expanded "><a href="config-windows.html"><strong aria-hidden="true">4.3.</strong> Windows-specific Container Configuration</a></li><li class="chapter-item expanded "><a href="config-vm.html"><strong aria-hidden="true">4.4.</strong> Virtual-machine-specific Container Configuration</a></li><li class="chapter-item expanded "><a href="config-zos.html"><strong aria-hidden="true">4.5.</strong> z/OS Container Configuration</a></li></ol></li><li class="chapter-item expanded "><a href="glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="implementations.html"><strong aria-hidden="true">6.</strong> Implementations</a></li><li class="chapter-item expanded "><a href="style.html"><strong aria-hidden="true">7.</strong> Style and conventions</a></li><li class="chapter-item expanded "><a href="GOVERNANCE.html"><strong aria-hidden="true">8.</strong> Project governance</a></li><li class="chapter-item expanded "><a href="RELEASES.html"><strong aria-hidden="true">9.</strong> Releases</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OCI Runtime Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="runtime-and-lifecycle"><a class="header" href="#runtime-and-lifecycle"><a name="runtimeAndLifecycle" />Runtime and Lifecycle</a></h1>
<h2 id="scope-of-a-container"><a class="header" href="#scope-of-a-container"><a name="runtimeScopeContainer" />Scope of a Container</a></h2>
<p>The entity using a runtime to create a container MUST be able to use the operations defined in this specification against that same container.
Whether other entities using the same, or other, instance of the runtime can see that container is out of scope of this specification.</p>
<h2 id="state"><a class="header" href="#state"><a name="runtimeState" />State</a></h2>
<p>The state of a container includes the following properties:</p>
<ul>
<li>
<p><strong><code>ociVersion</code></strong> (string, REQUIRED) is version of the Open Container Initiative Runtime Specification with which the state complies.</p>
</li>
<li>
<p><strong><code>id</code></strong> (string, REQUIRED) is the container's ID.
This MUST be unique across all containers on this host.
There is no requirement that it be unique across hosts.</p>
</li>
<li>
<p><strong><code>status</code></strong> (string, REQUIRED) is the runtime state of the container.
The value MAY be one of:</p>
<ul>
<li><code>creating</code>: the container is being created (step 2 in the <a href="#lifecycle">lifecycle</a>)</li>
<li><code>created</code>: the runtime has finished the <a href="#create">create operation</a> (after step 2 in the <a href="#lifecycle">lifecycle</a>), and the container process has neither exited nor executed the user-specified program</li>
<li><code>running</code>: the container process has executed the user-specified program but has not exited (after step 8 in the <a href="#lifecycle">lifecycle</a>)</li>
<li><code>stopped</code>: the container process has exited (step 10 in the <a href="#lifecycle">lifecycle</a>)</li>
</ul>
<p>Additional values MAY be defined by the runtime, however, they MUST be used to represent new runtime states not defined above.</p>
</li>
<li>
<p><strong><code>pid</code></strong> (int, REQUIRED when <code>status</code> is <code>created</code> or <code>running</code> on Linux, OPTIONAL on other platforms) is the ID of the container process.
For hooks executed in the runtime namespace, it is the pid as seen by the runtime.
For hooks executed in the container namespace, it is the pid as seen by the container.</p>
</li>
<li>
<p><strong><code>bundle</code></strong> (string, REQUIRED) is the absolute path to the container's bundle directory.
This is provided so that consumers can find the container's configuration and root filesystem on the host.</p>
</li>
<li>
<p><strong><code>annotations</code></strong> (map, OPTIONAL) contains the list of annotations associated with the container.
If no annotations were provided then this property MAY either be absent or an empty map.</p>
</li>
</ul>
<p>The state MAY include additional properties.</p>
<p>When serialized in JSON, the format MUST adhere to the JSON Schema <a href="schema/state-schema.json"><code>schema/state-schema.json</code></a>.</p>
<p>See <a href="#query-state">Query State</a> for information on retrieving the state of a container.</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code class="language-json">{
    &quot;ociVersion&quot;: &quot;0.2.0&quot;,
    &quot;id&quot;: &quot;oci-container1&quot;,
    &quot;status&quot;: &quot;running&quot;,
    &quot;pid&quot;: 4422,
    &quot;bundle&quot;: &quot;/containers/redis&quot;,
    &quot;annotations&quot;: {
        &quot;myKey&quot;: &quot;myValue&quot;
    }
}
</code></pre>
<h2 id="lifecycle"><a class="header" href="#lifecycle"><a name="runtimeLifecycle" />Lifecycle</a></h2>
<p>The lifecycle describes the timeline of events that happen from when a container is created to when it ceases to exist.</p>
<ol>
<li>OCI compliant runtime's <a href="runtime.html#create"><code>create</code></a> command is invoked with a reference to the location of the bundle and a unique identifier.</li>
<li>The container's runtime environment MUST be created according to the configuration in <a href="config.html"><code>config.json</code></a>.
If the runtime is unable to create the environment specified in the <a href="config.html"><code>config.json</code></a>, it MUST <a href="#errors">generate an error</a>.
While the resources requested in the <a href="config.html"><code>config.json</code></a> MUST be created, the user-specified program (from <a href="config.html#process"><code>process</code></a>) MUST NOT be run at this time.
Any updates to <a href="config.html"><code>config.json</code></a> after this step MUST NOT affect the container.</li>
<li>The <a href="config.html#prestart"><code>prestart</code> hooks</a> MUST be invoked by the runtime.
If any <code>prestart</code> hook fails, the runtime MUST <a href="#errors">generate an error</a>, stop the container, and continue the lifecycle at step 12.</li>
<li>The <a href="config.html#createRuntime-hooks"><code>createRuntime</code> hooks</a> MUST be invoked by the runtime.
If any <code>createRuntime</code> hook fails, the runtime MUST <a href="#errors">generate an error</a>, stop the container, and continue the lifecycle at step 12.</li>
<li>The <a href="config.html#createContainer-hooks"><code>createContainer</code> hooks</a> MUST be invoked by the runtime.
If any <code>createContainer</code> hook fails, the runtime MUST <a href="#errors">generate an error</a>, stop the container, and continue the lifecycle at step 12.</li>
<li>Runtime's <a href="runtime.html#start"><code>start</code></a> command is invoked with the unique identifier of the container.</li>
<li>The <a href="config.html#startContainer-hooks"><code>startContainer</code> hooks</a> MUST be invoked by the runtime.
If any <code>startContainer</code> hook fails, the runtime MUST <a href="#errors">generate an error</a>, stop the container, and continue the lifecycle at step 12.</li>
<li>The runtime MUST run the user-specified program, as specified by <a href="config.html#process"><code>process</code></a>.</li>
<li>The <a href="config.html#poststart"><code>poststart</code> hooks</a> MUST be invoked by the runtime.
If any <code>poststart</code> hook fails, the runtime MUST <a href="#warnings">log a warning</a>, but the remaining hooks and lifecycle continue as if the hook had succeeded.</li>
<li>The container process exits.
This MAY happen due to erroring out, exiting, crashing or the runtime's <a href="runtime.html#kill"><code>kill</code></a> operation being invoked.</li>
<li>Runtime's <a href="runtime.html#delete"><code>delete</code></a> command is invoked with the unique identifier of the container.</li>
<li>The container MUST be destroyed by undoing the steps performed during create phase (step 2).</li>
<li>The <a href="config.html#poststop"><code>poststop</code> hooks</a> MUST be invoked by the runtime.
If any <code>poststop</code> hook fails, the runtime MUST <a href="#warnings">log a warning</a>, but the remaining hooks and lifecycle continue as if the hook had succeeded.</li>
</ol>
<h2 id="errors"><a class="header" href="#errors"><a name="runtimeErrors" />Errors</a></h2>
<p>In cases where the specified operation generates an error, this specification does not mandate how, or even if, that error is returned or exposed to the user of an implementation.
Unless otherwise stated, generating an error MUST leave the state of the environment as if the operation were never attempted - modulo any possible trivial ancillary changes such as logging.</p>
<h2 id="warnings"><a class="header" href="#warnings"><a name="runtimeWarnings" />Warnings</a></h2>
<p>In cases where the specified operation logs a warning, this specification does not mandate how, or even if, that warning is returned or exposed to the user of an implementation.
Unless otherwise stated, logging a warning does not change the flow of the operation; it MUST continue as if the warning had not been logged.</p>
<h2 id="operations"><a class="header" href="#operations"><a name="runtimeOperations" />Operations</a></h2>
<p>Unless otherwise stated, runtimes MUST support the following operations.</p>
<p>Note: these operations are not specifying any command-line APIs, and the parameters are inputs for general operations.</p>
<h3 id="query-state"><a class="header" href="#query-state"><a name="runtimeQueryState" />Query State</a></h3>
<p><code>state &lt;container-id&gt;</code></p>
<p>This operation MUST <a href="#errors">generate an error</a> if it is not provided the ID of a container.
Attempting to query a container that does not exist MUST <a href="#errors">generate an error</a>.
This operation MUST return the state of a container as specified in the <a href="#state">State</a> section.</p>
<h3 id="create"><a class="header" href="#create"><a name="runtimeCreate" />Create</a></h3>
<p><code>create &lt;container-id&gt; &lt;path-to-bundle&gt;</code></p>
<p>This operation MUST <a href="#errors">generate an error</a> if it is not provided a path to the bundle and the container ID to associate with the container.
If the ID provided is not unique across all containers within the scope of the runtime, or is not valid in any other way, the implementation MUST <a href="#errors">generate an error</a> and a new container MUST NOT be created.
This operation MUST create a new container.</p>
<p>All of the properties configured in <a href="config.html"><code>config.json</code></a> except for <a href="config.html#process"><code>process</code></a> MUST be applied.
<a href="config.html#process"><code>process.args</code></a> MUST NOT be applied until triggered by the <a href="#start"><code>start</code></a> operation.
The remaining <code>process</code> properties MAY be applied by this operation.
If the runtime cannot apply a property as specified in the <a href="config.html">configuration</a>, it MUST <a href="#errors">generate an error</a> and a new container MUST NOT be created.</p>
<p>The runtime MAY validate <code>config.json</code> against this spec, either generically or with respect to the local system capabilities, before creating the container (<a href="#lifecycle">step 2</a>).
Runtime callers who are interested in pre-create validation can run <a href="implementations.html#testing--tools">bundle-validation tools</a> before invoking the create operation.</p>
<p>Any changes made to the <a href="config.html"><code>config.json</code></a> file after this operation will not have an effect on the container.</p>
<h3 id="start"><a class="header" href="#start"><a name="runtimeStart" />Start</a></h3>
<p><code>start &lt;container-id&gt;</code></p>
<p>This operation MUST <a href="#errors">generate an error</a> if it is not provided the container ID.
Attempting to <code>start</code> a container that is not <a href="#state"><code>created</code></a> MUST have no effect on the container and MUST <a href="#errors">generate an error</a>.
This operation MUST run the user-specified program as specified by <a href="config.html#process"><code>process</code></a>.
This operation MUST generate an error if <code>process</code> was not set.</p>
<h3 id="kill"><a class="header" href="#kill"><a name="runtimeKill" />Kill</a></h3>
<p><code>kill &lt;container-id&gt; &lt;signal&gt;</code></p>
<p>This operation MUST <a href="#errors">generate an error</a> if it is not provided the container ID.
Attempting to send a signal to a container that is neither <a href="#state"><code>created</code> nor <code>running</code></a> MUST have no effect on the container and MUST <a href="#errors">generate an error</a>.
This operation MUST send the specified signal to the container process.</p>
<h3 id="delete"><a class="header" href="#delete"><a name="runtimeDelete" />Delete</a></h3>
<p><code>delete &lt;container-id&gt;</code></p>
<p>This operation MUST <a href="#errors">generate an error</a> if it is not provided the container ID.
Attempting to <code>delete</code> a container that is not <a href="#state"><code>stopped</code></a> MUST have no effect on the container and MUST <a href="#errors">generate an error</a>.
Deleting a container MUST delete the resources that were created during the <code>create</code> step.
Note that resources associated with the container, but not created by this container, MUST NOT be deleted.
Once a container is deleted its ID MAY be used by a subsequent container.</p>
<h2 id="hooks"><a class="header" href="#hooks"><a name="runtimeHooks" />Hooks</a></h2>
<p>Many of the operations specified in this specification have &quot;hooks&quot; that allow for additional actions to be taken before or after each operation.
See <a href="./config.html#posix-platform-hooks">runtime configuration for hooks</a> for more information.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="bundle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="runtime-linux.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="bundle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="runtime-linux.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
